Content

[[_TOC_]]

`Available for review`
# Creation of Sales Invoice  
A Sales Invoice is generated by multiple methods based on delivery method & location of available stock of the items.    
Sales Invoice can be created without any reference to Sales Order or by converting the available Sales Order. Ready stock Sales invoice are created at retailer where Sales team directly visit retailer with stocks available with them, normally they carry stock in Van, this also referred as Van Sales Invoice. Counter Sales Invoice are created for direct end customer at distributor location.  

## Precondition for creating Sales Invoice
Before creating a direct sales invoice, you need to 
* Create [Customer](Customer)
* Create [Item](Product) details & have stock in hand 
* Create [Beat](Beat) & [Salesman](Salesman)

Creation of Sales invoice vary based on type of creation. 

## To create Sales Invoice

1. **Invoice Date** is often set to default current date
   - There are options to allow backdated invoice but date after present date are restricted. 

2. **In the Customer field**, enter the name of an existing customer. 
   - Sales Invoice are created to document the sale of goods to customer. 
   - After Customer selection, Customer related information are pre-populated as below,  
     - default [Beat](Beat), 
     - default [Salesman](Salesman), 
     - default Customer [Payment Mode](Payment Mode), 
     - default Customer [Credit Term](Credit Term), 
     - default [Customer Shipping address](Customer) & 
     - default [Customer Billing address](Customer) are loaded.

> Further, these details are allowed to be modified as necessary.  

3. **Select a [Beat](Beat)** related to the selected Customer 
    - Multiple beats are loaded when the Customer is associated with multiple Beat

4. **Select a [Salesman](Salesman)** related to the selected Customer 
    - Multiple Salesman are listed based on the Customer associated with multiple Beat. 

5. **Select a Payment Mode** appropriately
6. **Select a Credit Term** if Payment Mode is credit.  

7. Stock **Location**
    - default distributor Godown/Van loaded depending on type of invoice
    - user can select appropriately, if there are multiple values in list.     

8. **[Transaction Series](Transaction Series)**
    - default Sales Invoice Transaction Series are loaded, User can change these details as necessary. 

9. **Customer Shipping address** 
    - default Shipping address loaded, User can change these details as necessary. 

10. **Customer Billing address** 
    - default Billing address loaded, User can change these details as necessary. 

11. Fill in or Modify the remaining fields on the Sales Invoice page as necessary.
    - Reference number Manual
    - Reference number Additional
    - Secondary Transaction series 
    - Remark 
    - Reason  
    - Description
    - Terms and Conditions
    - Vehicle number 
    - Referred by
    - Salesman Category Group 
    - Product Category Group (based on Salesman Category Group)
    - Delivery date
    - Tax Form 

> _These are the header details requires for creation of any Sales Invoice._
> _You are now ready to fill in the Sales Invoice lines for products that you are selling to the Customer._

## Addition of line level details
12. **Select a [Product](Product)** from list of eligible product for sales. 
    - After selection of line level [Product](Product), related information are pre-populated  
      - Batch details from current stock of [Distributor](Distributor)
      - Price to customer [PTR](#rate-calculation)
      - [Available Stock Quantity](Stock & Inventory) 
      - Sales [UOM](Unit of Measurement) 
      - [Applicable Tax](#rate-calculation) 

13. **Provide the sales quantity**
    - After providing the sales quantity, 
      - The value in the Line Amount field is calculated as Unit Price x Quantity. 
      - [Applies Tax](#tax) based on predefined [Tax Master](Tax Master) settings
      - Line level [Net Amount](Sales Invoice Calculation) is calculated. 

14. Fill in the **Discount** as necessary, to re-compute Tax amount & Net amount.
    - Amount Discount 
    - Percentage Discount 
    - Discount Per UOM
    - Manual Free Item  

15. **[Scheme defined](Scheme Master)** for item are applied as per configuration. 
    - any Scheme discount applied will re-compute the Tax amount & Net amount. 
    - Scheme product free are loaded based as per scheme.   
    - [Scheme applied](#scheme) at line level and overall document level. 

16. **Net amount** is computed after discount, Scheme discount & Tax related impact. 
    - _refer [Sales Invoice calculation logic](#rate-calculation)_

17. _Repeat **Addition of line level details** Step for adding more lines of item._ 

## Invoice Discount & Adjustments 

18. **Invoice level discount** can be provided to re-compute final [Invoice Amount](#rate-calculation)
    - Amount Discount 
    - Percentage Discount 
    - Discount Per UOM
    - Invoice Level Scheme Discount

19. **Adjustment** 
    - User can Manual adjust or Auto adjust the available open [Credit Note document](Credit Note) of the selected customer. 
    - These Adjustments are posted as implicit [Collection](Collection), these adjustment amount will not reduce the invoice net amount, it has impact in invoice outstanding amount. 

20. **Save Sales Invoice** 
On Saving of the Sales Invoice document, 
    - Document of sales is recorded with generation of unique Sales Invoice Transaction number for a Distributor. 
    - Line Item & quantity of details provided are reduced from the [current stock](Stock & Inventory) of the selected stock location. 
    - (Adjustment & Outstanding)(Sales Invoice Adjustment Logic) details are posted as implicit [Collection](Collection) to the selected customer. Credit note documents are adjusted as require. 
    - reference transactions are updated like Sales order status update based on fulfillment. Customer outstanding modified. Customer Master update for address change. These are part of workflow as per configuration.  
    - Off take scheme benefit applied are accounted and updated. 
    - Report data consolidation initiated for relevant data points. 
    - Sales Invoice is ready to [Print](Sales Invoice Print)
    - Invoice delivery process to be initiated for the prepared invoice. 

## Cancellation 
Cancellation of Sales Invoice are action performed on un-deliverable sales invoice after preparation of Sales Invoice. The reason may vary like "Wrongly created invoice", "Delivery failure", "Not accepted during delivery" ..etc. Cancelled invoice are not referred in any further transaction like adjustment or collections. Cancelled invoice are considered as valid document and used in all report.  

Cancellation of Sales invoice are restricted based on configuration & workflow, few points as below. 

  - Business level restriction may vary based on configuration.  
    - Delivered Sales invoice are not allowed to cancel, instead sales return to be performed to maintain the logical accounting transactions. 

  - Data integrity related restrictions
    - Validation fails, if the stock impact update creates negative stock scenario. 
    - Validation fails if the customer outstanding update creates negative value scenario. 
    - Validation fails if the implicitly created collection and related adjustment creates negative value scenario.
    - Deactivated master reference like customer, product, distributor, beat, salesman ..etc. will have impact to fail the cancellations. 

On Cancel of Sales Invoice document, 
  - Document marked for status change to indicate cancellation. 
  - Stock impact reversed by adding stock to the current state of outstanding. 
  - Customer outstanding reversed by reducing the cancelled invoice value.  
  - Cancellation action on implicitly created collection is performed and Adjusted documents are reversed to current state to reflect current pending of the respective document.  
  - Off take scheme balance reversed. 
  - Cancelled invoice are considered as valid document and used in all tax report.
  - Report related Sales data recomputed. 

## Amendment 
Amendment to Sales invoice are corrections to the prepared sales invoice. 
Amendment is not editing in record, the amended document is referred as valid document with status amended. 

Amendment performs validation and two primary actions as below, 
  - Cancel the old document of sales invoice by executing all cancellation action as mentioned in [Sales Invoice cancellation section](#cancellation) 

  - Amendment of sales invoice are restricted to Business level restriction & Data integrity related restriction as mentioned in [cancellation](#cancellation) section. 

  - Further, Modification of key parameters are not allowed like Customer, Salesman, Beat.  

  - A new Sales invoice created with Sales invoice transaction number of old document. all action performed during sales invoice save are applicable for the newly created sales invoice document. 

# Types of Sales Invoice
- Godown Sales Invoice
  - [Sales Invoice Direct](Sales-Invoice-Creation#sales-invoice-direct) without Sales Order reference 
  - [Sales Invoice by converting Sales order](Sales-Invoice-Creation#create-sales-invoice-by-converting-sales-order) 
  - [Counter Sales Invoice](Sales-Invoice-Creation#sales-invoice-counter)
- [Ready Sales Invoice](Sales-Invoice-Creation#sales-invoice-van) 

## Sales Invoice Direct
Sales invoice direct are created at distributor location, without any reference to Sales order. The reference to the demand by customer are not recorded in application. 

**Key difference from other Sales invoice creation process** 
1. Stock Location will be [Godown](Godown).  
2. User to provide all product related details manually 
3. All other details are as similar as explained in [create](Sales-Invoice-Creation#to-create-sales-invoice). 

## Create Sales Invoice by converting Sales Order 
Sales Order are recorded by Salesman during market visit to record the demand and sales of the products. A [Sales Order](Sales Order) records the customer's intent to buy the listed products at the stated price. 

User can choice the open sales orders to convert it into Sales invoice. Sales Order to Sales Invoice conversion can be achieved in various options, as mentioned below.  
   1. Single Order conversion to Single [Sales Invoice](Sales Invoice)
   2. Bulk Order Processing with user input to confirm each [Sales Invoice](Sales Invoice)
   3. Bulk Order Processing to auto create [Sales Invoice](Sales Invoice)

[Customer](Customer), [Salesman](Salesman), [Beat](Beat) and Item information are pre-loaded (pre-fetched from Sales Order) to create the invoice during conversion using Option 1 & 2.

Option 3, is auto processed to create Sales Invoice. 

**Key difference from other Sales invoice creation process** 
1. All Mandatory data are pre populated based on Sales Order. 
2. During business validations, Decision to skip or continue are decided based on configuration to minimize manual intervention. 
3. During Sales Invoice save process, the reference Sales order will be closed or partially closes based on fulfillment. 
4. After Sales Invoice creation, delivery process to be initiated. 
5. _All other information are similar as described in create section. _

## Sales Invoice Van
Ready stock sales is referred as Van sales, Salesman travels along with Vehicle loaded with enough stock. At Retailer location, based on the market need Sales invoice created and Products are delivered immediately.

**Key difference from other Sales invoice creation process** 
1. Stock Location will be [Van](Van).  
2. User to provide all product related details manually 
3. All other details are as similar. 

## Sales Invoice Counter 
Counter Sales Invoice is commonly used in "POS" - Point of Sales, where seller sales to [End consumer](Customer Type) 

Counter Sales Invoice is applicable for [Cash Customers](Customer Types) only. Counter Sales Invoices are created using [Counter SalesMan](SalesMan) & [Counter Beat](Beat). The [pricing logic](Sales Invoice Pricing Logic), [discounts](Sales Invoice Discount Logic) and [schemes](Sales Invoice Scheme Logic) are different for counter sales.

Customer & Customer details are optional & non mandatory in Counter Sales Invoice. Additionally, new customers can be created on the fly and the customer details can be captured before creating the invoice. 

**Key difference from other Sales invoice creation process** 
1. Stock Location will be [Godown](Godown).  
2. Only Counter sales related customer, beat, salesman are listed for customer selection. Additionally walk-in customer details can be added. 
3. Payment mode will be cash. 
4. Price of product are MRP / ECP value of the selected batch. Further, Sales Price will be based on Pricing logic as explained in [Rate Calculation](#rate-calculation)  
5. User to provide all product related details manually 
6. All other details are as similar as explained in [create](Sales-Invoice-Creation#to-create-sales-invoice). 

# Business Rule & Impact 

> Business rules are listed in the below section which requires Domain understanding, hope the previous sections of the Sales invoice are clear. Refer [Sales Invoice](Sales Invoice), [Sales Invoice Creation](#creation-of-sales-invoice)   

1. [FD-BR-SI-0001](#FD-BR-SI-0001) - User access 
    1. Login user should has association with a Distributor. 
    1. In case of user associated with multiple user, then distributor selection is require before creating sales invoice transaction 
    1. User with profile access configurations are to be applied while Listing Sales Invoice, Create, Modify, View Sales invoice

    > Refer User profile, Distributor User, Corporate User Distributor mapping 

1. [FD-BR-SI-0002](#FD-BR-SI-0002) - List view of Sales Invoice
    1. Listing page is default landing page, where newly created Sales invoice are listed with selected information.
    1. All listing page related features are to be available for Sales Invoice listing Page. 
    1. Retrieve recently created top `20` Sales invoice document with selected field where it belongs to a Distributor and sort with invoice date. Default filter for Sales invoice applicable for all users. 
    1. Custom filter to be available for all modules
    1. Default list view fields for distributor users  
      - "transactionNumber" 
      - "invoiceDate" 
      - "reference1Manual" 
      - "uniqueRetailerCode" 
      - "customername" 
      - "salesmanName" 
      - "beatname" 
      - "godownName" 
      - "buyerStatename" 
      - "sellerStatename" 
      - "invoiceAmount" 
      - "invoiceOutstanding" 
      - "status"
      - "nextStageName"
      - "modifiedon" 

       In default list view of users associated with multiple Distributors, 
       add `Distributor Name` fields. 

  > Refer [Listing page](Listing Page) functionalities, [Custom Filter](Custom Filter).

1. [FD-BR-SI-0003](FD-BR-SI-0003) - Detail view actions
    1. Detail view of Invoice record enables you to perform actions like editing, cancel, amend, print the existing record in PDF format, all actions are configured through [Workflow](Workflow). 
    1. From the Invoices list view, select the desired record. Details view of invoice record should follow the Field access rule for the login user related profile. 

1. [FD-BR-SI-0004](FD-BR-SI-0004) - Create Sales Invoice
    1. Allow creation of Sales invoice based on Profile access configuration. 
    1. User Distributor association is mandatory for creating transaction. 
    1. Corporate User are indirect users create transaction related to specific associated distributor. 
    1. Creation of Sales Invoice should be restricted to user without distributor association. 

1. [FD-BR-SI-0005] -  Customer Selection 
    1. Listing of Customer


## Rate calculation 
1. **Sale Price** is shown in any of the following ways.
    - PTR value stored in Batch
    - Special price defined for the customer channel and GST registration status. 
    - When Bill at latest price is enabled for the item in the item master then latest Base Price is always considered until Special price is  defined for the item. 
    - User can override the rate based on settings

2. **UOM** can be selected as **Base UOM**, **UOM 1**, **UOM 2** ...,**UOM 7**
    - For this sample, Base UOM, UOM 1 & UOM 2 are only considered. 

    - **Sample Product UOM conversion & Rate** _Product Atta 2 KG_
 
| UOM Type | UOM | Conversion Factor | Batch Rate | Special Price | Base Price |
| ------ | ------ | ------ | ------ | ------ | ------ | 
| Base UOM | KG | 1 | 44.41 | 40 | 44.60 |
| UOM 1 | CFC | 30 | 1332.30 | 1200 | 1338 |
| UOM 2 | PAC | 2 | 88.82 | 80 | 89.2 |

3. **Tax**
    - **Sample Product Tax** _Product Atta 2 KG_

| Tax Component  | Tax %  |
|----------------|--------|
| SGST           | 2.50%  |
| CGST           | 2.50%  |

4. **Sample Calculation**

| Detail Field                         | Description & Calculation Formula                                                                           |
|--------------------------------------|-------------------------------------------------------------------------------------------------------------|
| Item Name                            | User can select the product by Item Code or Name                                                            |
| Batch                                | By default first batch is selected. Batch is listed on FIFO logic                                           |
| UOM                                  | Default Sales UOM is selected initially. User can change if required by shortcut also or manually change it |
| Sale Price                           | PTR of the item is shown. PTR is considered based on the Margin or Channel Wise Margin or Quotation         |
| Net Rate                             | Sale Price of item + Tax Amount is calculated for 1 quantity and shown.                                     |
| Quantity                             | User can enter quantity. Quantity entered is considered as per UOM selected                                 |
| Amount                               | Quantity * Sale Price is calculated and shown                                                               |
| Discount%                            | Manual discount percentage                                                                                  |
| Discount Amount                      | Discount Amount is shown                                                                                    |
| Scheme Discount%                     | Scheme Discount % is shown. For Amount scheme also, Discount % is also calculated and shown                 |
| Scheme Amount                        | Scheme Amount is shown.  Even for % Scheme, Discount Amount is calculated and shown                         |
| Net Amount (Taxable)                 | Taxable net amount. Amount - (Scheme Amount + Discount Amount). Based on configuration this formula varies |
| Tax Amount (Tax Split up also shown) | Tax Amount calculated on Net Amount is calculated & Shown                                                   |
| Net Tax Amount                       | Tax amount deducted on proposition from Additional Discount given in Invoice is shown here                  |
| Type                                 | Always Second Sales                                                                                         |
| Total                                | Net Amount + Tax Amount is calculated & Shown                                                               |
| Scheme Discount (Invoice Level)      | Invoice level Scheme Discount is propositioned item level and shown                                         |
| Trade Discount (Invoice Level)       | Invoice level Trade Discount amount is proportioned item level and shown                                    |
| Net Amount                           | Total - (Trade Discount + Scheme Discount) is calculated and shown                                          |

  - Sale Price : PTR of the item
  - Net Rate : Sale Price of item + Tax Amount is calculated for 1 quantity and shown.
  - Amount : (Quantity * Sale Price)
  - Discount Amount : Amount * Discount% or Direct amount given by end user
  - Scheme Amount : Amount * Scheme Discount% or Scheme Amount As per definition of scheme. 
  - Net Amount (Taxable) : Amount - (Scheme Amount + Discount Amount) 
> Based on configuration, `Net Amount (Taxable)` varies. 
  - Tax Amount : Net Amount (Taxable) * Tax % `Calculate for each component of Tax`
  - Total : Net Amount (Taxable) + Tax Amount
  - Net Amount : Total - (Trade Discount + Scheme Discount)


| Product   | Quantity | UOM | Rate  | Amount | Scheme Discount | Discount | Tax   | Net Rate | Net Amount |
|-----------|----------|-----|-------|--------|-----------------|----------|-------|----------|------------|

    - Base UOM without discount 

| Product   | Quantity | UOM | Rate  | Amount | Scheme Discount | Discount | Tax   | Net Rate | Net Amount |
|-----------|----------|-----|-------|--------|-----------------|----------|-------|----------|------------|
| Atta 2 KG | 2        | KG  | 44.41 | 88.82  | 0               | 0        | 4.441 | 46.6305  | 93.261     |

    - Base UOM - with Scheme and Other discount

 | Product   | Quantity | UOM | Rate  | Amount | Scheme Discount | Discount | Tax   | Net Rate | Net Amount |
|-----------|----------|-----|-------|--------|-----------------|----------|-------|----------|------------|
| Atta 2 KG | 2        | KG  | 44.41 | 88.82  | 5               | 2        | 4.091 | 42.9555  | 85.911     |

    - UOM1 - without discount
| Product   | Quantity | UOM | Rate   | Amount | Scheme Discount | Discount | Tax    | Net Rate | Net Amount |
|-----------|----------|-----|--------|--------|-----------------|----------|--------|----------|------------|
| Atta 2 KG | 2        | CFC | 1332.3 | 2664.6 | 0               | 0        | 133.23 | 1398.915 | 2797.83    |

    - UOM 1- with Scheme and Other discount
| Product   | Quantity | UOM | Rate   | Amount | Scheme Discount | Discount | Tax    | Net Rate | Net Amount |
|-----------|----------|-----|--------|--------|-----------------|----------|--------|----------|------------|
| Atta 2 KG | 2        | CFC | 1332.3 | 2664.6 | 5               | 2        | 132.88 | 1395.24  | 2790.48    |
    - When Net Rate is changed (Base UOM - without discount)
| Product   | Quantity | UOM | Rate  | Amount | Scheme Discount | Discount | Tax  | Net Rate | Net Amount |
|-----------|----------|-----|-------|--------|-----------------|----------|------|----------|------------|
| Atta 2 KG | 2        | KG  | 42.86 | 85.71  | 0               | 0        | 4.29 | 45       | 90         |

    - When Net Rate is changed (Base UOM - with discount)

| Product   | Quantity | UOM | Rate  | Amount | Scheme Discount | Discount | Tax  | Net Rate | Net Amount |
|-----------|----------|-----|-------|--------|-----------------|----------|------|----------|------------|
| Atta 2 KG | 2        | KG  | 98.74 | 197.48 | 5               | 2        | 9.52 | 100      | 200        |


## Scheme 
  - Sales Invoice are applied with respective scheme as defined or applicable. 
  - Applicable scheme are based on various criteria's like Product, Product category, Customer, Customer Type, Channel Type, Distributor, Distributor Cluster, Geo hierarchy, Mode of payment, ..etc. Refer [Scheme master](Scheme) for types of scheme. 
  - Different types of Scheme applies, some of the most used Scheme Type as below, 
    - Item by Quantity
    - Item by Value
    - Item By Qty - Lines cut 
    - `SMJ Pending - Add invoice level scheme types`
  - Gross Amount : (Quantity * Sale Price)
  - Gross Amount with tax : (Quantity * Rate + Tax)
  - After Manual Discount : ((Quantity * Rate - line level Addl. Discount)
  - After Manual Discount with tax : ((Quantity * Rate - line level Addl. Discount+ Tax)
  - **On-Take Scheme** are applied while preparing the Sales invoice. 
  - **Off-Take Scheme** benefits are applied as per the pending benefit list as applicable for the selected customer. 
  - Sales invoice scheme benefits are [computed](Scheme engine) and applied.  
  
## Tax 
  - Tax Components can be
    - 1. State Tax
    - 2. Central Tax
    - 3. Inter-state Tax
    - 4. Cess
    - 5. Cess on Quantity
    - 6. Cess applicable for the particular state
  - Tax applicable for the product, related geo hierarchy of distributor, [State](State) of distributor, [State](State) of Customer, Tax identifier details of customer, Tax form applied for the customer.
  - Multiple Tax are applicable for an item based on tax definition. All relevant tax details with split-up percentage to be available in Sales invoice document. 
  - Accurate calculation of tax amount is main criteria of Sales invoice document.



# See also .. 
  - [Sales Invoice](Sales Invoice)
  - [Sales Invoice Configurations](Sales Invoice Configurations)
  - [Domain Object Sales Invoice](Domain Object Sales Invoice)
  - [Home](Home)
